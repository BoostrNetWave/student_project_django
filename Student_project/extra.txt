                {% comment %} <div class="collapse navbar-collapse" id="navbarText">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0 mt-4 mt-lg-0">
                        <li class="nav-item"><a class="nav-link" href="{% url "studentpost" %}">Posts</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url "services" %}">Services</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url "talents" %}">Talents</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url "contactus" %}">Contact Us</a></li>
                        <li class="nav-item dropdown">
                          <a class="nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa-solid fa-user"></i>
                          </a>
                          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                              <li><a class="dropdown-item" href="{% url "profiles" %}">Profile</a></li>
                              <li><a class="dropdown-item" href="{% url "settings" %}">Setting</a></li>
                              <li><a class="dropdown-item" href="{% url "messages" %}">Message</a></li>
                              <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="href="{% url 'logout' %}"">Logout</a></li>
                          </ul>
                        </li>
                    </ul>
                    <ul class="navbar-nav flex-row mb-2 mb-lg-0 ms-lg-3">
                        <li class="nav-item me-2">
                            <a href="{% url 'signup' %}"><button class="px-3"> <span>Sign Up</span></button></a>
                        </li>
                        <li class="nav-item" >
                            <a href="{% url 'login' %}"><button class="px-3"> <span>Log In</span></button></a>
                        </li>
                    </ul>
                </div> {% endcomment %}


from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required
from signUp.models import CustomUser, CandidateProfile, RecruiterProfile

@login_required
def profiles_View(request):
    if request.user.is_authenticated:
        user = request.user
        context = {'user': user}

        if user.role == CustomUser.CANDIDATE:
            try:
                candidate_profile = CandidateProfile.objects.get(user=user)
                context['profile'] = candidate_profile
                context['role'] = 'candidate'
                print(context)
            except CandidateProfile.DoesNotExist:
                context['error_message'] = 'No CandidateProfile found for your account.'
                
        elif user.role == CustomUser.RECRUITER:
            try:
                recruiter_profile = RecruiterProfile.objects.get(user=user)
                context['profile'] = recruiter_profile
                context['role'] = 'recruiter'
                print(context)
            except RecruiterProfile.DoesNotExist:
                context['error_message'] = 'No RecruiterProfile found for your account.'
        else:
            context['error_message'] = 'Invalid user role.'

        return render(request, 'profiles/profiles.html', context)
    else:
        return redirect('login')


from django.shortcuts import render, redirect
from .forms import ProjectExperienceForm

def add_project(request):
    try:
        project_user = get_object_or_404(ProjectExperience, user=request.user)
    except UserProfile.DoesNotExist:
        project_user = ProjectExperience(user=request.user)
    if request.method == 'POST':
        P_form = ProjectExperienceForm(request.POST ,instance=project_user)
        if P_form.is_valid():
            # Save the form data to the database
            P_form.save()
            # Redirect to a success page or display a success message
            messages.success(request, 'Profile updated successfully.')
            return redirect('profiles')  # Replace 'profile' with the name of the URL pattern for the profile page
        else:
            messages.error(request, 'Error updating profile. Please check the form and try again.')
            # Redirect to the profile page after successful form submission
    else:
        form = ProjectExperienceForm()
    return render(request, 'profiles/project_experience.html', {'form': form})


@login_required
def settings_View(request):
    user_profile = get_object_or_404(UserProfile, user=request.user)
    user = request.user

    if user.role == CustomUser.RECRUITER:
        profile = get_object_or_404(RecruiterProfile, user=user)
    else:
        profile = get_object_or_404(CandidateProfile, user=user)

    user_profile_form = UserProfileForm(instance=user_profile)
    project_experience_form = ProjectExperienceForm()
    
    context = {
        'user_profile_form': user_profile_form,
        'project_experience_form': project_experience_form,
        'user_profile': user_profile,
        'custom_user': user,
        'profile': profile,
    }
    
    return render(request, 'profiles/settings.html', context)


@login_required
def update_personal_info(request):
    if request.method == 'POST':
        user = request.user
        user_profile_form = UserProfileForm(request.POST, instance=user.userprofile)
        if user_profile_form.is_valid():
            user_profile_form.save()
            # Update additional fields based on user role
            if user.role == CustomUser.RECRUITER:
                recruiter_profile = get_object_or_404(RecruiterProfile, user=user)
                recruiter_profile.company = request.POST.get('company')
                recruiter_profile.save()
            else:
                candidate_profile = get_object_or_404(CandidateProfile, user=user)
                # Additional fields for candidate profile can be updated here if needed

            messages.success(request, 'Your personal information has been updated successfully.')
            return redirect('settings')
        else:
            messages.error(request, 'Form validation error. Please check the entered data.')
            # Optionally, you can pass the form errors to the template for display
            return render(request, 'profiles/settings.html', {'user_profile_form': user_profile_form})
    else:
        messages.error(request, 'Invalid request method.')
        return redirect('settings')


@login_required
def settings_View(request):
    if request.user.is_authenticated:
        user = request.user
        if user.role == CustomUser.RECRUITER:
            profile = get_object_or_404(RecruiterProfile, user=user)
        else:
            profile = get_object_or_404(CandidateProfile, user=user)

    return render(request, 'profiles/settings.html')    


    {% comment %} <!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
        <button type="button" class=" px-3" data-dismiss="modal" aria-label="Close">
          <span><i class="fa-solid fa-xmark"></i></span>
        </button>
      </div>
      <div class="modal-body">
        <form id="changePasswordForm" method="post" action="{% url "change_password" %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="currentPassword">Current Password</label>
            <input type="password" class="form-control" id="currentPassword" name="current_password" placeholder="Enter current password" required>
          </div>
          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" class="form-control" id="newPassword" name="new_password" placeholder="Enter new password" required>
            <small id="passwordHelpBlock" class="form-text text-muted">
              Your password must be 8-20 characters long, contain letters and numbers, and must not contain spaces, special characters, or emoji.
            </small>
          </div>
          <div class="form-group">
            <label for="confirmPassword">Confirm New Password</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" placeholder="Confirm new password" required>
            <div class="invalid-feedback">
              Passwords do not match.
            </div>
          </div>
          <button type="submit" class="px-3"><span>Change Password</span></button>
        </form>
      </div>
    </div>
  </div>
</div> {% endcomment %}





@login_required
def settings_View(request):
    user_profile = get_object_or_404(UserProfile, user=request.user)

    if request.method == 'POST':
        if 'save_changes' in request.POST:
            form = EditUserForm(request.POST, instance=user_profile)
            if form.is_valid():
                form.save()
                messages.success(request, 'Settings updated successfully.')
                return redirect('settings')
            else:
                messages.error(request, 'Error updating settings. Please check the form and try again.')
        elif 'change_password' in request.POST:
            change_passform = CustomPasswordChangeForm(request.user, request.POST)
            if change_passform.is_valid():
                user = change_passform.save()
                update_session_auth_hash(request, user)  # Important for keeping the user logged in after password change
                messages.success(request, 'Your password has been changed successfully!')
                return redirect('settings')
            else:
                messages.error(request, 'Please correct the error below.')
    else:
        form = EditUserForm(instance=user_profile)
        change_passform = CustomPasswordChangeForm(request.user)

    profile = None
    if request.user.role == CustomUser.RECRUITER:
        profile = get_object_or_404(RecruiterProfile, user=request.user)
    elif request.user.role == CustomUser.CANDIDATE:
        profile = get_object_or_404(CandidateProfile, user=request.user)

    context = {
        'custom_user': request.user,
        'form': form,
        'profile': profile,
        'change_passform': change_passform,
    }

    return render(request, 'profiles/settings.html', context)

    {% extends "main/Layout.html" %}

{% load static %}

{% block title %}
Post Detailes
{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{% static 'css/button.css' %}">
<link rel="stylesheet" href="{% static 'css/services.css' %}">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}


{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/postdetail.css' %}">
{% endblock %}

{% block content %}
<section class="ezy__blogdetails1 light" id="ezy__blogdetails1">
    <div class="container">
      <div class="row">
        <div class="col-12 col-md-8">
          <h1 class="ezy__blogdetails1-heading mb-5">How to Pitch a Video Game: 7 Tips for Pitching Games</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-md-8">
          <img src="https://images.pexels.com/photos/1667088/pexels-photo-1667088.jpeg" alt="" class="img-fluid rounded" />
          <div class="d-flex justify-content-between my-5 me-5 flex-column">
            <h2 class="mb-4 fw-bolder">Student Management Project by Using Python and Django</h2>
            <div class="d-flex align-items-center mb-2">
              <div class="me-2">
                <img src="https://cdn.easyfrontend.com/pictures/testimonial/testimonial_square_1.jpeg" alt=""
                  class="img-fluid rounded-circle border" width="47" />
              </div>
              <div>
                <p class="mb-0">By <b>Surya Prasad Sahoo</b></p>
              </div>
              <p class="mb-0 ms-3">August 10th, 2020</p>
            </div>
            <div class="ezy__blogdetails1-social d-flex justify-content-between">
              <div class="star-rating ezy__footer13-quick-links">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
              </div>
              <ul class="ezy__footer13-quick-links">
                <a href=""><i class="fab fa-facebook me-3"></i></a>
                <a href=""><i class="fab fa-instagram me-3"></i></a>
                <a href=""><i class="fab fa-linkedin-in me-3"></i></a>
                <a href=""><i class="fab fa-twitter me-3"></i></a>
                <a href=""><i class="fab fa-whatsapp me-3"></i></a>
                <a href=""><i class="fas fa-share-alt me-3"></i></a>
                <a href=""><i class="fas fa-bookmark"></i></a>
              </ul>
            </div>
          </div>
          <div class="ezy__blogdetails1-content">
            <p>
              Teaching is a noble profession. Think about the most respected persons in our society. Yes, they are the
              teachers. If you ask someone about some of his favourite persons, it is most likely to find a teacher of
              him in his answer. So, being a teacher is an amazing thing. Besides, the career prospect in teaching is
              also lucrative. In England and Wales, as a Newly Qualified Teacher (NQT) you’ll earn £24,373 to £30,480
              depending on location Since you have decided to become a teacher, you may be known to all of these.
            </p>
            <p>
              Getting into teaching requires many years of preparation. If you don’t know how to become a teacher, you
              may find the way challenging. So, in this article, I’ll walk you through the steps to becoming a teacher
              in the UK.
            </p>
  
            <br />
            <h5>2. Decide your preferred subject</h5>
            <p>
              In primary schools, you may be responsible for teaching multiple subjects. But in the secondary schools,
              it’s most likely that you’ll be teaching the subject in which you did your major. So, it’s your choice
              which subject do you want to teach. It’s necessary to decide this because it will keep you on the track to
              become a teacher and step forward to make your preparation.
            </p>
  
            <br />
            <h5>3. Earn your bachelor degree</h5>
            <p>
              Unlike many other professions, teaching is very strict in its requirements. It’s because we don’t want to
              give the responsibility of educating our children to someone who doesn’t have the proper education and
              credentials. So, getting into teaching requires a minimum degree in the first place. After that, the other
              things come. You need a bachelor degree to become a teacher. There are also other specialized and advanced
              degrees, but you need your bachelor degree before everything.
            </p>
            <p>
              If you want to be a primary teacher, then you’ll need a degree of Bachelor of Education (BEd.) But, if you
              want to be a secondary teacher, you have to do your bachelor in your preferred subject. Your major in your
              degree will determine which subject you’ll be teaching. Earning a bachelor degree will require 3 to 4
              years. However, if you want to be a nursery or pre-school teacher, you don’t need a bachelor degree rather
              a proper license and certification in teaching children.
            </p>
          </div>
        </div>
        <div class="col-12 col-md-4 col-lg-3">
          <!-- Payment section -->
          <div class="ezy__blogdetails1-top py-4 px-3 mb-4">
            <h5 class="mb-0">Go with this cadidate</h5>
          </div>
          <div class="tab-content" id="packageTabsContent">
            <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
              <div class="price_card">
                <h5 class="price_card-title">I WILL EDIT REAL ESTATE 5 PHOTOS</h5>
                <p>Lens Correction, White Balance, Sky replacement, Repair Straight, vertical Horizontal</p>
                <ul class="features">
                    <li><i class="fas fa-clock"></i> 1-day delivery</li>
                    <li><i class="fas fa-sync"></i> Unlimited Revisions</li>
                    <li><i class="fas fa-images"></i> 5 images</li>
                    <li><i class="fas fa-file-image"></i> Printable resolution file</li>
                </ul>
                <p class="price">Price: <span>₹4056</span></p>
                <button class="px-3"><span>Continue</span></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</section>    

<section class="ezy__blog3 light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h2 class="ezy__blog3-heading mb-3 mt-0">View More Posts</h2>
      </div>
    </div>
    <div class="row mt-5">
      <div class="col-12 col-md-6 col-lg-4 mb-3">
        <article class="ezy__blog3-post h-100">
          <div class="position-relative">
            <img src="https://cdn.easyfrontend.com/pictures/blog/blog_3.jpg" alt="" class="img-fluid w-100" />
          </div>
          <div class="p-3 p-md-4">
              <div class="avatar">
                  <img class="post_avatar" src="{% static 'assets/alchemyrefiner_alchemymagic_2_78ad3111-a1a3-4ce8-8f9b-ff5c9b293956_0.jpg' %}" alt="avatar" width="80" height="80">
                  <span class="fw-bold m-2">Surya </span>
              </div>                    
            <h4 class="mt-3 ezy__blog3-title fs-4">Not Your Regular Home Decoration?</h4>
            <p class="ezy__blog3-description mt-3 mb-4">
              Urna molestie at eleme ntum eu facilisis sed odio Male suada fames.
            </p>
            <a href=""><button class="px-3"><span>Read More</span></button></a>
          </div>
        </article>
      </div>
      <div class="col-12 col-md-6 col-lg-4 mb-3">
        <article class="ezy__blog3-post h-100">
          <div class="position-relative">
            <img src="https://cdn.easyfrontend.com/pictures/blog/blog_9.jpg" alt="" class="img-fluid w-100" />
          </div>
          <div class="p-3 p-md-4">
              <div class="avatar">
                  <img class="post_avatar" src="{% static 'assets/alchemyrefiner_alchemymagic_2_78ad3111-a1a3-4ce8-8f9b-ff5c9b293956_0.jpg' %}" alt="avatar" width="80" height="80">
                  <span class="fw-bold m-2">Surya </span>
              </div>                    
            <h4 class="mt-3 ezy__blog3-title fs-4">How I’m Styling Everyday Black Outfits</h4>
            <p class="ezy__blog3-description mt-3 mb-4">
              t’s no secret that the digital industry is booming. From exciting startups to global brands.
            </p>
            <a href=""><button class="px-3"><span>Read More</span></button></a>
            
          </div>
        </article>
      </div>
      <div class="col-12 col-md-6 col-lg-4 mb-3">
        <article class="ezy__blog3-post h-100">
          <div class="position-relative">
            <img src="https://cdn.easyfrontend.com/pictures/blog/blog_14_1.jpg" alt="" class="img-fluid w-100" />
          </div>
          <div class="p-3 p-md-4">
              <div class="avatar">
                  <img class="post_avatar" src="{% static 'assets/alchemyrefiner_alchemymagic_2_78ad3111-a1a3-4ce8-8f9b-ff5c9b293956_0.jpg' %}" alt="avatar" width="80" height="80">
                  <span class="fw-bold m-2">Surya Prasad Sahoo</span>
              </div>
            <h4 class="mt-3 ezy__blog3-title fs-4">Fashion Essentials All Men Should Know</h4>
            <p class="ezy__blog3-description mt-3 mb-4">
              More off this less hello salamander lied porpoise much over tightly circa horse taped.
            </p>
            <a href=""><button class="px-3"><span>Read More</span></button></a>
          </div>
        </article>
      </div>
    </div>
  </div>
</section>
{% endblock %}

from django.forms import ValidationError
from django.shortcuts import get_object_or_404, render, redirect
from .forms import BlogPostForm
from .models import BlogPost
from profiles.models import UserProfile
from django.contrib import messages
from django.contrib.auth.decorators import login_required

# Create your views here.
@login_required
def studentPost(request):
    posts = BlogPost.objects.filter(user=request.user)
    user_profile = UserProfile.objects.get(user=request.user)
    print(user_profile)
    profile_image_url = user_profile.profile_image.url if user_profile.profile_image else None
    return render(request, 'studentPost/studentPost.html', {'posts': posts ,'user_profile': user_profile ,'profile_image_url': profile_image_url })

@login_required

def postDetail(request, post_id):
    post = get_object_or_404(BlogPost, id=post_id)
    related_posts = BlogPost.objects.filter(user=post.user).exclude(id=post.id)[:3]  # Fetch related posts by the same user, excluding the current post
    user_profile = UserProfile.objects.get(user=request.user)
    profile_image_url = user_profile.profile_image.url if user_profile.profile_image else None
    return render(request, 'studentPost/postdetailes.html', {'post': post, 'user_profile': user_profile , 'related_posts': related_posts ,'profile_image_url': profile_image_url})


@login_required
def create_blog_post(request):
    if request.method == 'POST':
        form = BlogPostForm(request.POST, request.FILES)
        if form.is_valid():
            try:
                blog_post = form.save(commit=False)
                blog_post.user = request.user  # Assign the current user
                blog_image = request.FILES.get('blog_image')
                if blog_image:
                    # Print debug information
                    print(f'Uploaded image name: {blog_image.name}')
                    print(f'Uploaded image size: {blog_image.size}')
                    max_filename_length = 1000
                    if len(blog_image.name) > max_filename_length:
                        blog_image.name = blog_image.name[:max_filename_length]
                    blog_post.blog_image = blog_image  # Save the image
                blog_post.save()
                messages.success(request, 'Blog post created successfully.')
                print('Blog post created successfully.')
                return redirect('studentpost')  # Redirect to a success page or the list of posts
            except ValidationError as e:
                error_messages = e.message_dict
                print(f'Validation errors: {error_messages}')
                form = BlogPostForm()
                return render(request, 'studentPost/post_creation_form.html', {'form': form, 'error_messages': error_messages})
            except Exception as e:
                messages.error(request, f'Error while creating the post: {e}')
                print(f'Error while creating the post: {e}')
        else:
            messages.error(request, 'Form is not valid. Please check the fields.')
            print('Form is not valid. Please check the fields.')
    else:
        form = BlogPostForm()
    return render(request, 'studentPost/post_creation_form.html', {'form': form})



{% extends "main/Layout.html" %}

{% load static %}

{% block title %}
Post Details
{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{% static 'css/button.css' %}">
<link rel="stylesheet" href="{% static 'css/services.css' %}">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/studentpost.css' %}">
{% endblock %}

{% block content %}
<section class="ezy__blog7 light">
    <div class="container-fluid d-flex justify-content-center" style="max-height: 500px;">
      <img src="https://images.pexels.com/photos/4065876/pexels-photo-4065876.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="" class="w-100" style="object-fit: cover;" />
    </div>

    <div class="ezy__blog7-wrapper">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-lg-center">
            <h2 class="ezy__blog7-heading mb-3 mt-0">Let's Now make an impression.</h2>
            <p class="ezy__blog7-sub-heading mb-4">
              "Create stunning blog posts effortlessly. Share your insights, engage with readers, and build your online presence globally."
            </p>
            <a href="{% url 'create_blog_post' %}"><button class="px-3"><span>Create Post</span></button></a>
          </div>
        </div>

        <div class="row mt-5">
          {% for post in posts %}
          <div class="col-12 col-md-6 col-lg-4 mb-3">
            <article class="ezy__blog7-post">
              <div class="position-relative">
                {% if post.blog_image %}
                <img
                  src="{{ post.blog_image.url }}"
                  alt="Blog image"
                  class="img-fluid w-100 ezy-blog7-banner"
                />
                {% else %}
                <!-- Use a sample image -->
                <img
                  src="{% static 'assets/el-logo-de-automatia-la-innovadora-startup-especia-gkjFy6O-S_2MhMyJ9i_btQ-61EwEfxyRYiLIEA3QthxDg.jpeg' %}"
                  alt="Sample Image"
                  class="img-fluid w-100 ezy-blog7-banner"
                />
                {% endif %}
                <div class="px-4 py-3 ezy__blog7-calendar">{{ post.publication_date|date:"d M Y" }}</div>
              </div>
              <div class="p-3 p-md-4">
                <h4 class="mt-3 ezy__blog7-title fs-4 mb-4">{{ post.title }}</h4>
                <div class="avatar">
                  {% if user_profile.profile_image %}
                  <img class="post_avatar" src="{{ user_profile.profile_image.url }}" alt="avatar" width="80" height="80">
                  {% else %}
                  <img class="post_avatar" src="{% static 'assets/candidate2.jpg' %}" alt="avatar" width="80" height="80">
                  {% endif %}
                  <span class="fw-bold m-2">{{ related_post.user.first_name }} {{ related_post.user.last_name }}</span>
                </div>
                <p class="ezy__blog7-description mt-3 mb-4">
                  {{ post.content|truncatewords:20 }}
                </p>
                <a href="{% url 'postdetail' post.id %}"><button class="px-3"><span>Read More</span></button></a>
              </div>
            </article>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
</section>
{% endblock %}


# from django.shortcuts import render
# from studentPost.models import BlogPost
# from profiles.models import UserProfile

# # Create your views here.
# def services_View(request):
#     posts = BlogPost.objects.all()
#     user_profile = UserProfile.objects.get(user=request.user)
#     print(user_profile)
#     profile_image_url = user_profile.profile_image.url if user_profile.profile_image else None
#     print(profile_image_url)
#     return render(request, 'services/services.html', {'posts': posts ,'user_profile': user_profile ,'profile_image_url': profile_image_url })

# from django.shortcuts import render
# from studentPost.models import BlogPost

# def services_View(request):
#     posts = BlogPost.objects.all()
#     profile_image_url = None  # Initialize profile_image_url to None for unauthenticated users
#     return render(request, 'services/services.html', {'posts': posts, 'profile_image_url': profile_image_url})
